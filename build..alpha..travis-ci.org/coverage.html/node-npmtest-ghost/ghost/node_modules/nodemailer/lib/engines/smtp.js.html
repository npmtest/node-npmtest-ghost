<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for node-npmtest-ghost/ghost/node_modules/nodemailer/lib/engines/smtp.js</title>
    <meta charset="utf-8">
    <style>
        body, html {
            margin:0; padding: 0;
        }
        body {
            font-family: Arial, Helvetica;
            font-size: 10pt;
        }
        div.header, div.footer {
            background: #eee;
            padding: 1em;
        }
        div.header {
            height: 160px;
            padding: 0 1em 0 1em;
            z-index: 100;
            position: fixed;
            top: 0;
            border-bottom: 1px solid #666;
            width: 100%;
        }
        div.footer {
            border-top: 1px solid #666;
        }
        div.body {
            margin-top: 170px;
        }
        div.meta {
            font-size: 90%;
            text-align: center;
        }
        h1, h2, h3 {
            font-weight: normal;
        }
        h1 {
            font-size: 12pt;
        }
        h2 {
            font-size: 10pt;
        }
        pre {
            font-family: Menlo, Monaco, Consolas, Courier New, monospace;
            margin: 0;
            padding: 0;
            font-size: 14px;
            tab-size: 2;
        }

        div.path { font-size: 110%; }
        div.path a:link, div.path a:visited { color: #000; }
        table.coverage { border-collapse: collapse; margin:0; padding: 0 }

        table.coverage td {
            margin: 0;
            padding: 0;
            color: #111;
            vertical-align: top;
        }
        table.coverage td.line-count {
            width: 50px;
            text-align: right;
            padding-right: 5px;
        }
        table.coverage td.line-coverage {
            color: #777 !important;
            text-align: right;
            border-left: 1px solid #666;
            border-right: 1px solid #666;
        }

        table.coverage td.text {
        }

        table.coverage td span.cline-any {
            display: inline-block;
            padding: 0 5px;
            width: 40px;
        }
        table.coverage td span.cline-neutral {
            background: #eee;
        }
        table.coverage td span.cline-yes {
            background: #b5d592;
            color: #999;
        }
        table.coverage td span.cline-no {
            background: #fc8c84;
        }

        .cstat-yes { color: #111; }
        .cstat-no { background: #fc8c84; color: #111; }
        .fstat-no { background: #ffc520; color: #111 !important; }
        .cbranch-no { background:  yellow !important; color: #111; }

        .cstat-skip { background: #ddd; color: #111; }
        .fstat-skip { background: #ddd; color: #111 !important; }
        .cbranch-skip { background: #ddd !important; color: #111; }

        .missing-if-branch {
            display: inline-block;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: black;
            color: yellow;
        }

        .skip-if-branch {
            display: none;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: #ccc;
            color: white;
        }

        .missing-if-branch .typ, .skip-if-branch .typ {
            color: inherit !important;
        }

        .entity, .metric { font-weight: bold; }
        .metric { display: inline-block; border: 1px solid #333; padding: 0.3em; background: white; }
        .metric small { font-size: 80%; font-weight: normal; color: #666; }

        div.coverage-summary table { border-collapse: collapse; margin: 3em; font-size: 110%; }
        div.coverage-summary td, div.coverage-summary table  th { margin: 0; padding: 0.25em 1em; border-top: 1px solid #666; border-bottom: 1px solid #666; }
        div.coverage-summary th { text-align: left; border: 1px solid #666; background: #eee; font-weight: normal; }
        div.coverage-summary th.file { border-right: none !important; }
        div.coverage-summary th.pic { border-left: none !important; text-align: right; }
        div.coverage-summary th.pct { border-right: none !important; }
        div.coverage-summary th.abs { border-left: none !important; text-align: right; }
        div.coverage-summary td.pct { text-align: right; border-left: 1px solid #666; }
        div.coverage-summary td.abs { text-align: right; font-size: 90%; color: #444; border-right: 1px solid #666; }
        div.coverage-summary td.file { text-align: right; border-left: 1px solid #666; white-space: nowrap;  }
        div.coverage-summary td.pic { min-width: 120px !important;  }
        div.coverage-summary a:link { color: #000; }
        div.coverage-summary a:visited { color: #333; }
        div.coverage-summary tfoot td { border-top: 1px solid #666; }

        div.coverage-summary .yui3-datatable-sort-indicator, div.coverage-summary .dummy-sort-indicator {
            height: 10px;
            width: 7px;
            display: inline-block;
            margin-left: 0.5em;
        }
        div.coverage-summary .yui3-datatable-sort-indicator {
            background: no-repeat scroll 0 0 transparent;
        }
        div.coverage-summary .yui3-datatable-sorted .yui3-datatable-sort-indicator {
            background-position: 0 -20px;
        }
        div.coverage-summary .yui3-datatable-sorted-desc .yui3-datatable-sort-indicator {
            background-position: 0 -10px;
        }

        .high { background: #b5d592 !important; }
        .medium { background: #ffe87c !important; }
        .low { background: #fc8c84 !important; }

        span.cover-fill, span.cover-empty {
            display:inline-block;
            border:1px solid #444;
            background: white;
            height: 12px;
        }
        span.cover-fill {
            background: #ccc;
            border-right: 1px solid #444;
        }
        span.cover-empty {
            background: white;
            border-left: none;
        }
        span.cover-full {
            border-right: none !important;
        }
        pre.prettyprint {
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
        }
        .com { color: #999 !important; }
        .ignore-none { color: #999; font-weight: normal; }

    </style>
</head>
<body>
<div class="header low">
    <h1 style="font-weight: bold;">
        <a href="https://github.com/npmtest/node-npmtest-ghost">npmtest-ghost (v0.0.1)</a>
    </h1>
    <h1>Code coverage report for <span class="entity">node-npmtest-ghost/ghost/node_modules/nodemailer/lib/engines/smtp.js</span></h1>
    <h2>
        
        Statements: <span class="metric">29.55% <small>(13 / 44)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Branches: <span class="metric">3.45% <small>(2 / 58)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Functions: <span class="metric">33.33% <small>(2 / 6)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Lines: <span class="metric">29.55% <small>(13 / 44)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../../../../../index.html">All files</a> &#187; <a href="index.html">node-npmtest-ghost/ghost/node_modules/nodemailer/lib/engines/</a> &#187; smtp.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">24</span>
<span class="cline-any cline-yes">15</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">24</span>
<span class="cline-any cline-yes">24</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">"use strict";
&nbsp;
var wellKnownHosts = require("../wellknown"),
    simplesmtp = require("simplesmtp"),
    wellKnownDomains = {};
&nbsp;
// Expose to the world
module.exports = SMTPTransport;
&nbsp;
// Convert Wellknown keys to lowercase
wellKnownHosts = Object.keys(wellKnownHosts).reduce(function(lowerCaseKeys, currentKey){
&nbsp;
    [].concat(wellKnownHosts[currentKey].domains || []).forEach(function(domain){
        wellKnownDomains[domain] = currentKey.toLowerCase().trim();
    });
&nbsp;
    lowerCaseKeys[currentKey.toLowerCase().trim()] = wellKnownHosts[currentKey];
    return lowerCaseKeys;
},{});
&nbsp;
/**
 * &lt;p&gt;Generates a Transport object for SMTP&lt;/p&gt;
 *
 * &lt;p&gt;NB! This is a pool of connections that try to keep themselves alive. The
 * connection is not closed to the server once the message is delivered.&lt;/p&gt;
 *
 * &lt;p&gt;Possible options can be the following:&lt;/p&gt;
 *
 * &lt;ul&gt;
 *     &lt;li&gt;&lt;b&gt;service&lt;/b&gt; - a well known service identifier ("Gmail", "Hotmail"
 *         etc.) for auto-completing host, port and secure connection settings&lt;/li&gt;
 *     &lt;li&gt;&lt;b&gt;host&lt;/b&gt; - hostname of the SMTP server&lt;/li&gt;
 *     &lt;li&gt;&lt;b&gt;port&lt;/b&gt; - port of the SMTP server&lt;/li&gt;
 *     &lt;li&gt;&lt;b&gt;secureConnection&lt;/b&gt; - use SSL&lt;/li&gt;
 *     &lt;li&gt;&lt;b&gt;name&lt;/b&gt; - the name of the client server&lt;/li&gt;
 *     &lt;li&gt;&lt;b&gt;authMethod&lt;/b&gt; -specified the authMethod, value can be ["plain", "login"], default is "plain"&lt;/li&gt;
 *     &lt;li&gt;&lt;b&gt;auth&lt;/b&gt; - authentication object as &lt;code&gt;{user:"...", pass:"..."}&lt;/code&gt;
 *     &lt;li&gt;&lt;b&gt;ignoreTLS&lt;/b&gt; - ignore server support for STARTTLS&lt;/li&gt;
 *     &lt;li&gt;&lt;b&gt;debug&lt;/b&gt; - output client and server messages to console&lt;/li&gt;
 *     &lt;li&gt;&lt;b&gt;maxConnections&lt;/b&gt; - how many connections to keep in the pool&lt;/li&gt;
 *     &lt;li&gt;&lt;b&gt;maxMessages&lt;/b&gt; - limit the count of messages to send through a single connection&lt;/li&gt;
 *     &lt;li&gt;&lt;b&gt;greetingTimeout&lt;/b&gt; - Time to wait in ms until greeting message is received from the server (defaults to 10000)&lt;/li&gt;
 *     &lt;li&gt;&lt;b&gt;socketTimeout&lt;/b&gt; - Time of inactivity until the connection is closed (defaults to 1 hour)&lt;/li&gt;
 * &lt;/ul&gt;
 *
 * @constructor
 * @param {Object} [options] SMTP options
 */
<span class="fstat-no" title="function not covered" >function SMTPTransport(options){</span>
<span class="cstat-no" title="statement not covered" >    this.options = options || {};</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    this.initOptions();</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    this.pool = simplesmtp.createClientPool(this.options.port,</span>
        this.options.host, this.options);
}
&nbsp;
SMTPTransport.wellKnownHosts = wellKnownHosts;
&nbsp;
// Setup version info for the transport
SMTPTransport.prototype.version = simplesmtp.version;
&nbsp;
/**
 * &lt;p&gt;Initializes the SMTP connection options. Needed mostly for legacy option
 * values and also for filling in the well known hosts data if needed.&lt;/p&gt;
 */
SMTPTransport.prototype.initOptions = <span class="fstat-no" title="function not covered" >function(){</span>
<span class="cstat-no" title="statement not covered" >    var keys, key, i, len, service;</span>
&nbsp;
    // provide support for legacy API
<span class="cstat-no" title="statement not covered" >    if(this.options.use_authentication === false){</span>
<span class="cstat-no" title="statement not covered" >        this.options.auth = false;</span>
    }else <span class="cstat-no" title="statement not covered" >if(this.options.user || this.options.pass || this.options.XOAuthToken){</span>
<span class="cstat-no" title="statement not covered" >        if(!this.options.auth){</span>
<span class="cstat-no" title="statement not covered" >            this.options.auth = {};</span>
        }
<span class="cstat-no" title="statement not covered" >        this.options.authMethod = this.options.authMethod || "PLAIN";</span>
<span class="cstat-no" title="statement not covered" >        this.options.auth.user = this.options.auth.user || this.options.user;</span>
<span class="cstat-no" title="statement not covered" >        this.options.auth.pass = this.options.auth.pass || this.options.pass;</span>
<span class="cstat-no" title="statement not covered" >        this.options.auth.XOAuthToken = this.options.auth.XOAuthToken || this.options.XOAuthToken;</span>
<span class="cstat-no" title="statement not covered" >        this.options.auth.XOAuth2 = this.options.auth.XOAuth2 || this.options.XOAuth2;</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    if(this.options.ssl){</span>
<span class="cstat-no" title="statement not covered" >        this.options.secureConnection = true;</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    if(this.options.tls === false){</span>
<span class="cstat-no" title="statement not covered" >        this.options.ignoreTLS = true;</span>
    }
&nbsp;
    // lets be modest just in case
<span class="cstat-no" title="statement not covered" >    this.options.maxConnections = this.options.maxConnections || 5;</span>
&nbsp;
    // detect service from the e-mail address if host is not provided before falling to localhost
<span class="cstat-no" title="statement not covered" >    if(!this.options.host &amp;&amp; !this.options.port &amp;&amp; !this.options.service &amp;&amp; this.options.auth &amp;&amp; this.options.auth.user){</span>
<span class="cstat-no" title="statement not covered" >        this.options.service = wellKnownDomains[(this.options.auth.user || "").toString().split("@").pop().toLowerCase().trim()] || false;</span>
    }
&nbsp;
    // use well known settings if service is defined
<span class="cstat-no" title="statement not covered" >    if((service = this.options.service) &amp;&amp; (service = service.toString().toLowerCase().trim()) &amp;&amp; wellKnownHosts[service]){</span>
<span class="cstat-no" title="statement not covered" >        keys = Object.keys(wellKnownHosts[service]);</span>
<span class="cstat-no" title="statement not covered" >        for(i=0, len=keys.length; i&lt;len; i++){</span>
<span class="cstat-no" title="statement not covered" >            key = keys[i];</span>
<span class="cstat-no" title="statement not covered" >            this.options[key] = this.options[key] ||</span>
                    wellKnownHosts[service][key];
        }
    }
};
&nbsp;
/**
 * &lt;p&gt;Forwards the mailcomposer message object to the simplesmpt client pool&lt;/p&gt;
 *
 * @param {Object} emailMessage MailComposer object
 * @param {Function} callback Callback function to run when the sending is completed
 */
SMTPTransport.prototype.sendMail = <span class="fstat-no" title="function not covered" >function(emailMessage, callback){</span>
    // force SMTP encoding
<span class="cstat-no" title="statement not covered" >    emailMessage.options.escapeSMTP = true;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    if(this.options.requiresAuth &amp;&amp;</span>
      (!this.options.auth || !((this.options.auth.user &amp;&amp; this.options.auth.pass) || this.options.auth.XOAuth2 || this.options.auth.XOAuthToken))){
<span class="cstat-no" title="statement not covered" >        return typeof callback == "function" &amp;&amp;</span>
            callback(new Error("Authentication required, invalid details provided"));
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    this.pool.sendMail(emailMessage, callback);</span>
};
&nbsp;
/**
 * &lt;p&gt;Closes the client pool&lt;/p&gt;
 *
 * @param {Function} callback Callback function to run once the pool is closed
 */
SMTPTransport.prototype.close = <span class="fstat-no" title="function not covered" >function(callback){</span>
<span class="cstat-no" title="statement not covered" >    this.pool.close(callback);</span>
};
&nbsp;
&nbsp;</pre></td></tr>
</table></pre>
</div>
<div class="footer">
    <div class="meta">Generated by <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a> at Tue Apr 11 2017 20:21:51 GMT+0000 (UTC)</div>
</div>
</body>
</html>
